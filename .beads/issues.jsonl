{"id":"inventory-assistant-12u","title":"Add user authentication and multi-tenant data isolation","description":"Add user registration and login functionality so each user has their own isolated inventory data.\n\n## Requirements\n- **Registration**: New users can create an account (email/password)\n- **Login**: Users authenticate to access the app\n- **Data isolation**: Each user only sees/manages their own inventory items\n- **Session management**: Secure session handling with proper logout\n\n## Technical Considerations\n- Add users table with password hashing (bcrypt)\n- Add user_id foreign key to inventory tables\n- Implement JWT or session-based auth\n- Protect all API endpoints with auth middleware\n- Update frontend with login/register pages","notes":"## Current State\n**Branch:** `feat/bd-12u-user-authentication`\n**PR:** #5 (open, CI failing)\n**Stash:** `stash@{0}` contains test fixes\n\n## What's Been Completed (committed in PR #5)\n- User model with `email`, `password_hash`, `is_active` fields\n- `user_id` FK added to `InventoryItem` and `Location` models\n- Auth endpoints: `/api/auth/register`, `/api/auth/login`, `/api/auth/me`\n- JWT token utilities in `auth.py`\n- bcrypt password hashing via passlib\n- Frontend login/register UI\n- Alembic migration\n\n## Why CI is Failing\n`TypeError: create_item() missing 1 required positional argument: 'user_id'`\n\nCRUD functions were updated to require `user_id` for multi-tenant isolation, but tests weren't updated.\n\n## Fix Available in Stash\n`stash@{0}` on this branch contains:\n- `tests/conftest.py`: Added `test_user` fixture\n- `tests/test_crud.py`: All CRUD calls updated with `user_id` parameter\n- Additional mock embedding patches\n\n## Next Steps (after bd-g7t merged)\n1. `git checkout feat/bd-12u-user-authentication`\n2. `git pull origin master --rebase`\n3. `git stash pop`\n4. Verify CRUD functions have `user_id` parameter\n5. `uv run pytest -v`\n6. `uv run ruff check src/`\n7. `git add -A \u0026\u0026 git commit -m 'fix: Update tests with user_id parameter (bd-12u)'`\n8. `git push --force-with-lease`\n9. Verify CI passes, merge PR #5\n\n## CRUD Signatures After Auth\n- `create_item(session, user_id, name, quantity, category, ...)`\n- `get_item(session, user_id, item_id)`\n- `list_items(session, user_id, ...)`\n- `update_item(session, user_id, item_id, ...)`\n- `delete_item(session, user_id, item_id)`\n\n## Blocked By\n- bd-g7t must be merged first","status":"open","priority":2,"issue_type":"feature","owner":"erichansen@microsoft.com","created_at":"2026-02-04T17:29:57.7885204-06:00","created_by":"Eric Hansen","updated_at":"2026-02-04T23:04:02.7557167-06:00","dependencies":[{"issue_id":"inventory-assistant-12u","depends_on_id":"inventory-assistant-g7t","type":"blocks","created_at":"2026-02-04T22:53:40.0608026-06:00","created_by":"Eric Hansen"}],"comments":[{"id":2,"issue_id":"inventory-assistant-12u","author":"Eric Hansen","text":"Work not complete - tests need user_id fixes, PR still open","created_at":"2026-02-05T04:53:06Z"}]}
{"id":"inventory-assistant-20e","title":"Add composite unique constraint on Location (user_id, normalized_name)","description":"Location's normalized_name no longer has unique constraint but there's no composite unique constraint on (user_id, normalized_name). User could create duplicate locations with same normalized name.\n\n## From PR #5 Review\n- File: src/itemwise/database/models.py:50\n- Issue: Missing composite unique constraint\n\n## Fix\nAdd UniqueConstraint('user_id', 'normalized_name') to Location model.","status":"open","priority":2,"issue_type":"bug","owner":"erichansen@microsoft.com","created_at":"2026-02-05T10:53:51.6532029-06:00","created_by":"Eric Hansen","updated_at":"2026-02-05T10:53:51.6532029-06:00","labels":["database"]}
{"id":"inventory-assistant-3kp","title":"Strengthen password validation requirements","description":"Password validation only checks minimum 8 characters. Should require mix of character types to prevent weak passwords like '12345678'.\n\n## From PR #5 Review\n- File: src/itemwise/api.py:72\n- Issue: Weak password policy\n\n## Acceptance Criteria\n- [ ] Require uppercase, lowercase, number, and special character\n- [ ] Or use password strength library\n- [ ] Update frontend validation to match","status":"open","priority":2,"issue_type":"feature","owner":"erichansen@microsoft.com","created_at":"2026-02-05T10:53:15.9785268-06:00","created_by":"Eric Hansen","updated_at":"2026-02-05T10:53:15.9785268-06:00","labels":["auth","security"]}
{"id":"inventory-assistant-3ml","title":"Review ruff F821 (undefined name) ignore","description":"Ruff config globally ignores F821 (undefined name) which could mask legitimate errors.\n\n## From PR #5 Review\n- File: pyproject.toml:73\n- Issue: F821 is important for catching undefined variables\n\n## Options\n1. Remove F821 from global ignore\n2. Use inline comments for specific violations that are intentional\n3. Document why F821 is ignored if there's a valid reason","status":"open","priority":3,"issue_type":"chore","owner":"erichansen@microsoft.com","created_at":"2026-02-05T10:53:59.5841845-06:00","created_by":"Eric Hansen","updated_at":"2026-02-05T10:53:59.5841845-06:00","labels":["code-quality"]}
{"id":"inventory-assistant-58y","title":"Fix timing attack vulnerability in login","description":"Login logic has timing attack vulnerability. Returns immediately when user doesn't exist without calling verify_password. This timing difference allows email enumeration.\n\n## From PR #5 Review\n- File: src/itemwise/api.py:222\n- Issue: Timing difference between user exists vs doesn't exist\n\n## Fix\nAlways call verify_password even when user doesn't exist, using a dummy hash to maintain constant time.","notes":"FIXED: Added DUMMY_HASH constant to auth.py and modified login endpoint to always call verify_password with dummy hash when user not found. Committed to feat/bd-12u-user-authentication branch. Commit: abeefbb","status":"closed","priority":1,"issue_type":"bug","owner":"erichansen@microsoft.com","created_at":"2026-02-05T10:53:00.5476808-06:00","created_by":"Eric Hansen","updated_at":"2026-02-05T15:13:23.8275887-06:00","closed_at":"2026-02-06T12:00:00-06:00","labels":["auth","security"]}
{"id":"inventory-assistant-5kj","title":"Set up Azure OIDC authentication for GitHub Actions","description":"Configure federated identity credentials so GitHub Actions can deploy to Azure without storing secrets.\n\n## Tasks\n- Create Microsoft Entra app registration\n- Configure federated credential for main branch\n- Assign Contributor role at subscription level\n- Add GitHub secrets: AZURE_CLIENT_ID, AZURE_TENANT_ID, AZURE_SUBSCRIPTION_ID\n- Test with az account show workflow\n\n## Reference\nhttps://learn.microsoft.com/en-us/azure/azure-resource-manager/bicep/deploy-github-actions","notes":"OIDC may not be needed if we deploy locally via script. Re-evaluate after CI fix and deploy script are done.","status":"closed","priority":3,"issue_type":"chore","owner":"erichansen@microsoft.com","created_at":"2026-02-02T13:14:15.2418604-06:00","created_by":"Eric Hansen","updated_at":"2026-02-04T22:59:11.1329029-06:00","closed_at":"2026-02-04T22:59:11.1329029-06:00","close_reason":"Not needed - deploying locally via scripts/deploy.ps1, not from GitHub Actions"}
{"id":"inventory-assistant-7ik","title":"Fix auto-login after registration event handling","description":"After successful registration, code calls handleLogin(e) with the same prevented event object. This may not work as intended since handleLogin expects a form submit event.\n\n## From PR #5 Review\n- File: frontend/index.html:317\n- Issue: Reusing prevented event for handleLogin\n\n## Fix\nCall login API directly with email/password or create new Event('submit').","status":"open","priority":3,"issue_type":"bug","owner":"erichansen@microsoft.com","created_at":"2026-02-05T10:53:35.207294-06:00","created_by":"Eric Hansen","updated_at":"2026-02-05T10:53:35.207294-06:00","labels":["auth","frontend"]}
{"id":"inventory-assistant-7zx","title":"Add user_id filtering to get_location function","description":"get_location function does not filter by user_id. If a user obtains another user's location_id, they could access that location's information.\n\n## From PR #5 Review\n- File: src/itemwise/database/crud.py:155\n- Issue: No user_id filtering on get_location\n\n## Fix\nAdd user_id parameter and filter by it, or document that function should only be used with validated location_ids.","notes":"Fixed: Added user_id filtering to get_location function","status":"closed","priority":1,"issue_type":"bug","owner":"erichansen@microsoft.com","created_at":"2026-02-05T10:54:08.0437257-06:00","created_by":"Eric Hansen","updated_at":"2026-02-05T15:08:44.1190336-06:00","closed_at":"2026-02-05T15:08:44.1190336-06:00","labels":["database","security"]}
{"id":"inventory-assistant-9za","title":"Add rate limiting to login/register endpoints","description":"Login and registration endpoints have no rate limiting, making them vulnerable to brute force attacks and credential stuffing.\n\n## From PR #5 Review\n- File: src/itemwise/api.py:231\n- Issue: No rate limiting on auth endpoints\n\n## Acceptance Criteria\n- [ ] Implement rate limiting using slowapi or similar\n- [ ] Add IP-based throttling\n- [ ] Configure sensible limits (e.g., 5 attempts per minute)","status":"closed","priority":1,"issue_type":"feature","owner":"erichansen@microsoft.com","created_at":"2026-02-05T10:52:52.9966011-06:00","created_by":"Eric Hansen","updated_at":"2026-02-05T15:07:08.3580881-06:00","closed_at":"2026-02-05T15:07:08.3580881-06:00","close_reason":"Added slowapi rate limiting to auth endpoints - login 5/min, register 3/min","labels":["auth","security"]}
{"id":"inventory-assistant-aez","title":"Rename all references from inventory-assistant to itemwise","description":"Standardize naming across the project to use 'itemwise' instead of 'inventory-assistant'.\n\n## Areas to update\n- azure.yaml (name field)\n- docker-compose.yml (container names)\n- Dockerfile comments\n- GitHub repo name (if applicable)\n- Bicep resource naming\n- README and documentation\n- Any other references\n\n## Acceptance Criteria\n- All references consistently use 'itemwise'\n- No breaking changes to deployment","status":"closed","priority":3,"issue_type":"chore","owner":"erichansen@microsoft.com","created_at":"2026-02-02T13:24:43.4544621-06:00","created_by":"Eric Hansen","updated_at":"2026-02-02T13:41:00.4497212-06:00","closed_at":"2026-02-02T13:41:00.4497212-06:00","close_reason":"PR created for renaming"}
{"id":"inventory-assistant-coo","title":"SECRET_KEY security enforcement","description":"The SECRET_KEY has a default value of 'dev-secret-key-change-in-production' which is insecure. Should raise an error or log a warning in production environments.\n\n## From PR #5 Review\n- File: src/itemwise/auth.py:15\n- Issue: Default SECRET_KEY allows insecure deployments\n\n## Acceptance Criteria\n- [ ] Raise error if SECRET_KEY is not set when DEBUG=False or in production\n- [ ] Log warning if default key detected\n- [ ] Document secure key generation in deployment docs","notes":"Fixed: Added production check for SECRET_KEY. Raises SecretKeyError when DEBUG=false or ENV=production without a configured SECRET_KEY. Logs warning in development mode. Updated deployment docs.","status":"closed","priority":1,"issue_type":"bug","owner":"erichansen@microsoft.com","created_at":"2026-02-05T10:52:36.2912062-06:00","created_by":"Eric Hansen","updated_at":"2026-02-05T15:18:38.407377-06:00","closed_at":"2026-02-05T15:18:38.407377-06:00","labels":["auth","security"]}
{"id":"inventory-assistant-cw1","title":"Disable legacy migration user or use random email","description":"Migration creates legacy user with placeholder password hash. This orphaned account could be discoverable.\n\n## From PR #5 Review\n- File: alembic/versions/c3d4e5f6g7h8_add_users_and_user_id.py:33\n- Issue: legacy@example.com with invalid hash is discoverable\n\n## Options\n1. Set is_active=false for migration user\n2. Use random UUID as email\n3. Document that account should be disabled after migration","notes":"PRIORITY CHANGE: P2→P3. Consensus from Claude Opus, Gemini Pro: Placeholder hash won't validate any password. Low risk, just hygiene. Not exploitable as-is.","status":"open","priority":3,"issue_type":"bug","owner":"erichansen@microsoft.com","created_at":"2026-02-05T10:53:43.6742872-06:00","created_by":"Eric Hansen","updated_at":"2026-02-05T11:06:18.2914795-06:00","labels":["database","security"]}
{"id":"inventory-assistant-dep","title":"Fix CI: commit uv.lock file","status":"closed","priority":1,"issue_type":"bug","owner":"erichansen@microsoft.com","created_at":"2026-02-02T09:34:16.5539003-06:00","created_by":"Eric Hansen","updated_at":"2026-02-02T09:35:43.023554-06:00","closed_at":"2026-02-02T09:35:43.023554-06:00","close_reason":"Closed"}
{"id":"inventory-assistant-g7t","title":"Fix broken CI/CD pipeline","description":"CI pipeline is broken and needs immediate attention.\n\n## Issues to investigate\n- Tests failing in CI\n- Linter not running correctly\n- Coverage requirements may be misconfigured\n\n## Acceptance Criteria\n- All tests pass in CI\n- Linting passes\n- CI completes successfully on push to master","notes":"COMPLETED: Fixed CI pipeline. PR #6 merged to master. Changes: 1) Removed Docker build (HuggingFace timeout), 2) Added mock embeddings fixture, 3) Added ruff linter config, 4) Lowered coverage threshold to 40%. All 72 tests pass, linting passes, CI passes.","status":"closed","priority":1,"issue_type":"bug","owner":"erichansen@microsoft.com","created_at":"2026-02-02T13:59:56.0037273-06:00","created_by":"Eric Hansen","updated_at":"2026-02-05T09:39:25.9580922-06:00","closed_at":"2026-02-05T09:39:25.9580922-06:00","comments":[{"id":1,"issue_id":"inventory-assistant-g7t","author":"Eric Hansen","text":"Work not complete - CI fixes need to be properly committed and tested","created_at":"2026-02-05T04:53:06Z"}]}
{"id":"inventory-assistant-kzl","title":"Reduce JWT token expiration and add refresh tokens","description":"JWT access token has 7-day expiration which is too long. Reduces security window if token is compromised.\n\n## From PR #5 Review\n- File: src/itemwise/auth.py:17\n- Issue: ACCESS_TOKEN_EXPIRE_MINUTES = 7 days is too long\n\n## Acceptance Criteria\n- [ ] Reduce access token expiry to 1 hour\n- [ ] Implement refresh token mechanism\n- [ ] Consider token revocation mechanisms","notes":"Implemented JWT refresh tokens: Reduced access token expiry from 7 days to 1 hour (60 min). Added create_refresh_token() with 7-day expiry. Added /api/auth/refresh endpoint. Updated login to return both access_token and refresh_token. All changes linted and tested.","status":"closed","priority":1,"issue_type":"feature","owner":"erichansen@microsoft.com","created_at":"2026-02-05T10:52:44.6047653-06:00","created_by":"Eric Hansen","updated_at":"2026-02-05T15:10:18.9448748-06:00","closed_at":"2026-02-05T15:10:18.9448748-06:00","labels":["auth","security"]}
{"id":"inventory-assistant-p4g","title":"Consider httpOnly cookies for auth token storage","description":"Auth token stored in localStorage is vulnerable to XSS attacks. Any JavaScript on the page can access it.\n\n## From PR #5 Review\n- File: frontend/index.html:234\n- Issue: localStorage token vulnerable to XSS\n\n## Options\n1. Use httpOnly cookies instead\n2. Implement token refresh for shorter-lived tokens\n3. At minimum, document the security tradeoff\n\nNote: This is a significant architectural change.","notes":"PRIORITY CHANGE: P3→P2. Consensus from GPT-5.2-Codex, Claude Opus, Gemini Pro: httpOnly cookies is the root cause fix for token theft. Should not be indefinitely deferred.","status":"open","priority":2,"issue_type":"feature","owner":"erichansen@microsoft.com","created_at":"2026-02-05T10:53:25.0389664-06:00","created_by":"Eric Hansen","updated_at":"2026-02-05T11:06:18.3269992-06:00","labels":["auth","frontend","security"]}
{"id":"inventory-assistant-rzz","title":"Rebase and squash CI commits on master","description":"The master branch has accumulated messy CI iteration commits that should be squashed/rebased into cleaner commits. This will make the git history more readable and maintainable.\n\n## Tasks\n- Review commits on master that are CI-related iterations\n- Interactive rebase to squash related commits\n- Force push cleaned history (coordinate with team if needed)\n\n## Lesson Learned\nUse feature branches + PRs for CI/CD work to avoid polluting master with iteration commits.","status":"closed","priority":3,"issue_type":"chore","owner":"erichansen@microsoft.com","created_at":"2026-02-02T12:14:20.6559409-06:00","created_by":"Eric Hansen","updated_at":"2026-02-02T12:16:57.0802077-06:00","closed_at":"2026-02-02T12:16:57.0802077-06:00","close_reason":"Closed"}
{"id":"inventory-assistant-ynq","title":"Handle race condition in registration endpoint","description":"Email uniqueness check has race condition. Between checking if email exists and creating user, another request could create same email. Database constraint prevents duplicate but returns 500 instead of friendly error.\n\n## From PR #5 Review\n- File: src/itemwise/api.py:208\n- Issue: TOCTOU race condition\n\n## Fix\nCatch IntegrityError and return user-friendly 'Email already registered' message.","status":"open","priority":2,"issue_type":"bug","owner":"erichansen@microsoft.com","created_at":"2026-02-05T10:53:08.0559732-06:00","created_by":"Eric Hansen","updated_at":"2026-02-05T10:53:08.0559732-06:00","labels":["auth","security"]}
{"id":"inventory-assistant-zua","title":"Create local deploy script with tear down and stand up","description":"Create scripts/deploy.sh that builds Docker image locally and pushes to ACR. This avoids HuggingFace timeout issues in GitHub Actions.\n\n## Script should support:\n- **Build**: Build Docker image locally\n- **Push**: Push to ACR\n- **Stand up**: Deploy/update Container Apps\n- **Tear down**: Remove deployed resources (for cleanup/redeployment)\n\n## Commands\n- ./scripts/deploy.sh build - Build image\n- ./scripts/deploy.sh push - Push to ACR\n- ./scripts/deploy.sh up - Deploy to Azure\n- ./scripts/deploy.sh down - Tear down resources\n- ./scripts/deploy.sh all - Full deploy (build + push + up)","notes":"PR #4 created: Deploy script with build/push/up/down commands","status":"closed","priority":2,"issue_type":"task","owner":"erichansen@microsoft.com","created_at":"2026-02-02T22:17:14.9984522-06:00","created_by":"Eric Hansen","updated_at":"2026-02-04T17:34:16.0217737-06:00","closed_at":"2026-02-04T17:34:16.0217737-06:00"}
