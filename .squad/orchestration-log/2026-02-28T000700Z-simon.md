# Orchestration Log: Simon (DevOps)

**Session:** 2026-02-28T000700Z (Resilience)  
**Agent:** Simon (DevOps / Infrastructure)  
**Model:** claude-opus-4.6  
**Status:** SUCCESS

## Directive

Implement DB readiness checks and health probes for Azure Container Apps to handle PostgreSQL auto-pause.

## Outcome

✅ Multi-layer health infrastructure implemented (branch `fix/db-health-probes`)

### Changes

1. **`start.sh`**
   - Added DB readiness loop (30s max, 2s intervals)
   - Uses Python `socket.connect()` (zero external dependencies)
   - Falls through gracefully if DB never becomes reachable

2. **`infra/resources.bicep`**
   - Liveness probe: `GET /health` every 30s, 3 failures to restart
   - Startup probe: `GET /health` every 10s, up to 30 failures (300s window)

3. **`Dockerfile` + `docker-compose.yml`**
   - Switched healthchecks from Python httpx to `curl -f` (lower overhead)
   - Added `curl` to Dockerfile apt-get

### Rationale
- Socket check is fast, zero-dependency, doesn't require `pg_isready`
- Startup probe's 300s window accommodates slow migrations
- Liveness probe ensures Azure restarts container if unhealthy
- `curl` healthcheck avoids importing entire Python runtime for HTTP check

## Decision Log

See `.squad/decisions/inbox/simon-health-probes.md`

## Notes

App gracefully starts even if DB is unreachable — health endpoint reports 503 until DB is available. No application code changes required.
